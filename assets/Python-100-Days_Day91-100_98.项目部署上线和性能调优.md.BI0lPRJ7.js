import{_ as i,c as a,a2 as n,o as l}from"./chunks/framework.BeuUUHFt.js";const p="/cherish-frontend-blog/assets/aliyun-domain.DFbf6RAp.png",e="/cherish-frontend-blog/assets/aliyun-keeprecord.e4FWoDNU.png",h="/cherish-frontend-blog/assets/aliyun-dnslist.1hdxEh0D.png",t="/cherish-frontend-blog/assets/aliyun-resolve-settings.Dz54j1RD.png",k="/cherish-frontend-blog/assets/aliyun-certificate.D35ctd8F.png",b=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"Python-100-Days/Day91-100/98.项目部署上线和性能调优.md","filePath":"Python-100-Days/Day91-100/98.项目部署上线和性能调优.md","lastUpdated":1731997977000}'),r={name:"Python-100-Days/Day91-100/98.项目部署上线和性能调优.md"};function d(B,s,c,g,y,F){return l(),a("div",null,s[0]||(s[0]=[n(`<h2 id="项目部署上线指南" tabindex="-1">项目部署上线指南 <a class="header-anchor" href="#项目部署上线指南" aria-label="Permalink to &quot;项目部署上线指南&quot;">​</a></h2><h3 id="准备上线" tabindex="-1">准备上线 <a class="header-anchor" href="#准备上线" aria-label="Permalink to &quot;准备上线&quot;">​</a></h3><ol><li><p>上线前的检查工作。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">python</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> manage.py</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> check</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> --deploy</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>将DEBUG设置为False并配置ALLOWED_HOSTS。</p><div class="language-Python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">DEBUG</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;"> False</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">ALLOWED_HOSTS</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&#39;*&#39;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>安全相关的配置。</p><div class="language-Python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 保持HTTPS连接的时间</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">SECURE_HSTS_SECONDS</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 3600</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">SECURE_HSTS_INCLUDE_SUBDOMAINS</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;"> True</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">SECURE_HSTS_PRELOAD</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;"> True</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 自动重定向到安全连接</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">SECURE_SSL_REDIRECT</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;"> True</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 避免浏览器自作聪明推断内容类型</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">SECURE_CONTENT_TYPE_NOSNIFF</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;"> True</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 避免跨站脚本攻击</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">SECURE_BROWSER_XSS_FILTER</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;"> True</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># COOKIE只能通过HTTPS进行传输</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">SESSION_COOKIE_SECURE</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;"> True</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">CSRF_COOKIE_SECURE</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;"> True</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 防止点击劫持攻击手段 - 修改HTTP协议响应头</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 当前网站是不允许使用&lt;iframe&gt;标签进行加载的</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">X_FRAME_OPTIONS</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &#39;DENY&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></li><li><p>敏感信息放到环境变量或文件中。</p><div class="language-Python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">SECRET_KEY</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> os</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">environ</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&#39;SECRET_KEY&#39;</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">DB_USER</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> os</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">environ</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&#39;DB_USER&#39;</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">DB_PASS</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> os</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">environ</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&#39;DB_PASS&#39;</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">REDIS_AUTH</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> os</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">environ</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&#39;REDIS_AUTH&#39;</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ol><h3 id="更新服务器python环境到3-x" tabindex="-1">更新服务器Python环境到3.x <a class="header-anchor" href="#更新服务器python环境到3-x" aria-label="Permalink to &quot;更新服务器Python环境到3.x&quot;">​</a></h3><blockquote><p>说明：如果需要清除之前的安装，就删除对应的文件和文件夹即可</p></blockquote><ol><li><p>安装底层依赖库。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> zlib-devel</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> bzip2-devel</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> openssl-devel</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> ncurses-devel</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> sqlite-devel</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> readline-devel</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> tk-devel</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> gdbm-devel</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> libdb4-devel</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> libpcap-devel</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> xz-devel</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> libffi-devel</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> libxml2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>下载Python源代码。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">wget</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> https://www.python.org/ftp/python/3.7.6/Python-3.7.6.tar.xz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>验证下载文件。</p><div class="language-Bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Bash</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">md5sum</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> Python-3.7.6.tar.xz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>解压缩和解归档。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">xz</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> Python-3.7.6.tar.xz</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">tar</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -xvf</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> Python-3.7.6.tar</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>执行安装前的配置（生成Makefile文件）。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> Python-3.7.6</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">./configure</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> --prefix=/usr/local/python37</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> --enable-optimizations</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>构建和安装。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;"> &amp;&amp;</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> make</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> install</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>配置PATH环境变量（用户或系统环境变量）并激活。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">vim</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> ~/.bash_profile</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">vim</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> /etc/profile</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-INI vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">INI</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">... 此处省略上面的代码...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">export </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">PATH</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">$PATH:/usr/local/python37/bin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">... 此处省略下面的代码...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;">source</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> ~/.bash_profile</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;">source</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> /etc/profile</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>注册软链接（符号链接）- 这一步不是必须的，但通常会比较有用。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">ln</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> /usr/local/python37/bin/python3</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> /usr/bin/python3</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>测试Python环境是否更新成功（安装Python 3一定不能破坏原来的Python 2）。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">python3</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> --version</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">python</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> --version</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol><h3 id="项目目录结构" tabindex="-1">项目目录结构 <a class="header-anchor" href="#项目目录结构" aria-label="Permalink to &quot;项目目录结构&quot;">​</a></h3><p>假设项目文件夹为<code>project</code>，下面的五个子目录分别是：<code>code</code>、<code>conf</code>、<code>logs</code>、<code>stat</code>和<code>venv</code>分别用来保存项目的代码、配置文件、日志文件、静态资源和虚拟环境。其中，<code>conf</code>目录下的子目录<code>cert</code>中保存了配置HTTPS需要使用的证书和密钥；<code>code</code>目录下的项目代码可以通过版本控制工具从代码仓库中检出；虚拟环境可以通过工具（如：venv、virtualenv、pyenv等）进行创建。</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>project</span></span>
<span class="line"><span>├── code</span></span>
<span class="line"><span>│   └── fangtx</span></span>
<span class="line"><span>│       ├── api</span></span>
<span class="line"><span>│       ├── common</span></span>
<span class="line"><span>│       ├── fangtx</span></span>
<span class="line"><span>│       ├── forum</span></span>
<span class="line"><span>│       ├── rent</span></span>
<span class="line"><span>│       ├── user</span></span>
<span class="line"><span>│       ├── manage.py</span></span>
<span class="line"><span>│       ├── README.md</span></span>
<span class="line"><span>│       ├── static</span></span>
<span class="line"><span>│       └── templates</span></span>
<span class="line"><span>├── conf</span></span>
<span class="line"><span>│   ├── cert</span></span>
<span class="line"><span>│   │   ├── 214915882850706.key</span></span>
<span class="line"><span>│   │   └── 214915882850706.pem</span></span>
<span class="line"><span>│   ├── nginx.conf</span></span>
<span class="line"><span>│   └── uwsgi.ini</span></span>
<span class="line"><span>├── logs</span></span>
<span class="line"><span>│   ├── access.log</span></span>
<span class="line"><span>│   ├── error.log</span></span>
<span class="line"><span>│   └── uwsgi.log</span></span>
<span class="line"><span>├── stat</span></span>
<span class="line"><span>│   └── css</span></span>
<span class="line"><span>│   └── images</span></span>
<span class="line"><span>│   └── js</span></span>
<span class="line"><span>└── venv</span></span>
<span class="line"><span>    ├── bin</span></span>
<span class="line"><span>    │   ├── activate</span></span>
<span class="line"><span>    │   ├── activate.csh</span></span>
<span class="line"><span>    │   ├── activate.fish</span></span>
<span class="line"><span>    │   ├── celery</span></span>
<span class="line"><span>    │   ├── celerybeat</span></span>
<span class="line"><span>    │   ├── celeryd</span></span>
<span class="line"><span>    │   ├── celeryd-multi</span></span>
<span class="line"><span>    │   ├── coverage</span></span>
<span class="line"><span>    │   ├── coverage3</span></span>
<span class="line"><span>    │   ├── coverage-3.7</span></span>
<span class="line"><span>    │   ├── django-admin</span></span>
<span class="line"><span>    │   ├── django-admin.py</span></span>
<span class="line"><span>    │   ├── easy_install</span></span>
<span class="line"><span>    │   ├── easy_install-3.7</span></span>
<span class="line"><span>    │   ├── pip</span></span>
<span class="line"><span>    │   ├── pip3</span></span>
<span class="line"><span>    │   ├── pip3.7</span></span>
<span class="line"><span>    │   ├── __pycache__</span></span>
<span class="line"><span>    │   ├── pyrsa-decrypt</span></span>
<span class="line"><span>    │   ├── pyrsa-decrypt-bigfile</span></span>
<span class="line"><span>    │   ├── pyrsa-encrypt</span></span>
<span class="line"><span>    │   ├── pyrsa-encrypt-bigfile</span></span>
<span class="line"><span>    │   ├── pyrsa-keygen</span></span>
<span class="line"><span>    │   ├── pyrsa-priv2pub</span></span>
<span class="line"><span>    │   ├── pyrsa-sign</span></span>
<span class="line"><span>    │   ├── pyrsa-verify</span></span>
<span class="line"><span>    │   ├── python -&gt; python3</span></span>
<span class="line"><span>    │   ├── python3 -&gt; /usr/bin/python3</span></span>
<span class="line"><span>    │   └── uwsgi</span></span>
<span class="line"><span>    ├── include</span></span>
<span class="line"><span>    ├── lib</span></span>
<span class="line"><span>    │   └── python3.7</span></span>
<span class="line"><span>    ├── lib64 -&gt; lib</span></span>
<span class="line"><span>    ├── pip-selfcheck.json</span></span>
<span class="line"><span>    └── pyvenv.cfg</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><p>下面以阿里云为例，简单说明如何为项目注册域名、解析域名以及购买权威机构颁发的证书。</p><ol><li><p><a href="https://wanwang.aliyun.com/domain/" target="_blank" rel="noreferrer">注册域名</a>。</p><p><img src="`+p+'" alt=""></p></li><li><p><a href="https://beian.aliyun.com/" target="_blank" rel="noreferrer">域名备案</a>。</p><p><img src="'+e+'" alt=""></p></li><li><p><a href="https://dns.console.aliyun.com/#/dns/domainList" target="_blank" rel="noreferrer">域名解析</a>。</p><p><img src="'+h+'" alt=""></p><p><img src="'+t+'" alt=""></p></li><li><p><a href="https://www.aliyun.com/product/cas" target="_blank" rel="noreferrer">购买证书</a>。</p><p><img src="'+k+`" alt=""></p></li></ol><p>可以使用类似于sftp的工具将证书上传到<code>conf/cert</code>目录，然后使用git克隆项目代码到<code>code</code>目录。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> code</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> clone</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">ur</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">l</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>回到项目目录，创建并激活虚拟环境。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">python3</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -m</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> venv</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> venv</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;">source</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> venv/bin/activate</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>重建项目依赖项。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">pip</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> code/teamproject/requirements.txt</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="uwsgi的配置" tabindex="-1">uWSGI的配置 <a class="header-anchor" href="#uwsgi的配置" aria-label="Permalink to &quot;uWSGI的配置&quot;">​</a></h3><ol><li><p>安装uWSGI。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">pip</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> uwsgi</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>修改uWSGI的配置文件（<code>/root/project/conf/uwsgi.ini</code>）。</p><div class="language-INI vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">INI</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">[uwsgi]</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置前导路径</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">base</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">/root/project</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置项目名称</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">name</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">teamproject</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 守护进程</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">master</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">true</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 进程个数</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">processes</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">4</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 虚拟环境</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">pythonhome</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">%(base)/venv</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 项目地址</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">chdir</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">%(base)/code/%(name)</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 指定python解释器</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">pythonpath</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">%(pythonhome)/bin/python</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 指定uwsgi文件</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">module</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">%(name).wsgi</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 通信的地址和端口(自己服务器的IP地址和端口)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">socket</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">172.18.61.250:8000</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 日志文件地址</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">logto</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">%(base)/logs/uwsgi.log</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><blockquote><p>说明：可以先将“通信的地址和端口”项等号前面改为http来进行测试，如果没有问题再改回 成socket，然后通过Nginx来实现项目的“动静分离”（静态资源交给Nginx处理，动态内容交给 uWSGI处理）。按照下面的方式可以启动uWSGI服务器。</p></blockquote></li><li><p>启动服务器。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">nohup</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> uwsgi</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> --ini</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> conf/uwsgi.ini</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;"> &amp;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ol><h3 id="nginx的配置" tabindex="-1">Nginx的配置 <a class="header-anchor" href="#nginx的配置" aria-label="Permalink to &quot;Nginx的配置&quot;">​</a></h3><ol><li><p>安装Nginx。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> nginx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>修改全局配置文件（<code>/etc/nginx/nginx.conf</code>）。</p><div class="language-Nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Nginx</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置用户</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">user </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">nginx;</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 工作进程数(建议跟CPU的核数量一致)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">worker_processes </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">auto;</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 错误日志</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">error_log </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">/var/log/nginx/error.log;</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 进程文件</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">pid </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">/run/nginx.pid;</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 包含其他的配置</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">include </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">/usr/share/nginx/modules/*.conf;</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 工作模式(多路IO复用方式)和连接上限</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">events</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    use </span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;">epoll</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    worker_connections </span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># HTTP服务器相关配置</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">http</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 日志格式</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    log_format </span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;"> main</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">  &#39;$</span><span style="--shiki-light:#FFAB70;--shiki-dark:#E06C75;">remote_addr</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> - $</span><span style="--shiki-light:#FFAB70;--shiki-dark:#E06C75;">remote_user</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> [$</span><span style="--shiki-light:#FFAB70;--shiki-dark:#E06C75;">time_local</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">] &quot;$</span><span style="--shiki-light:#FFAB70;--shiki-dark:#E06C75;">request</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&quot; &#39;</span></span>
<span class="line"><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">                      &#39;$</span><span style="--shiki-light:#FFAB70;--shiki-dark:#E06C75;">status</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> $</span><span style="--shiki-light:#FFAB70;--shiki-dark:#E06C75;">body_bytes_sent</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &quot;$</span><span style="--shiki-light:#FFAB70;--shiki-dark:#E06C75;">http_referer</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&quot; &#39;</span></span>
<span class="line"><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">                      &#39;&quot;$</span><span style="--shiki-light:#FFAB70;--shiki-dark:#E06C75;">http_user_agent</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&quot; &quot;$</span><span style="--shiki-light:#FFAB70;--shiki-dark:#E06C75;">http_x_forwarded_for</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&quot;&#39;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 访问日志</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    access_log </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> /var/log/nginx/access.log  </span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;">main</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 开启高效文件传输模式</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    sendfile </span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;">           on</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 用sendfile传输文件时有利于改善性能</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    tcp_nopush </span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;">         on</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 禁用Nagle来解决交互性问题</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    tcp_nodelay </span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;">        on</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 客户端保持连接时间</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    keepalive_timeout </span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">  30</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    types_hash_max_size </span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">2048</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 包含MIME类型的配置</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    include </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">            /etc/nginx/mime.types;</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 默认使用二进制流格式</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    default_type </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">       application/octet-stream;</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 包含其他配置文件</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    include </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">/etc/nginx/conf.d/*.conf;</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 包含项目的Nginx配置文件</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    include </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">/root/project/conf/*.conf;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div></li><li><p>编辑局部配置文件（<code>/root/project/conf/nginx.conf</code>）。</p><div class="language-Nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Nginx</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">server</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    listen </span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">     80</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    server_name </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">_;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    access_log </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">/root/project/logs/access.log;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    error_log </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">/root/project/logs/error.log;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">        include </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">uwsgi_params;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">        uwsgi_pass </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">172.18.61.250:8000;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> /static/ {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">        alias </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">/root/project/stat/;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">        expires </span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">30d</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">server</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    listen </span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">     443</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    server_name </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">_;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    ssl </span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;">        on</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    access_log </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">/root/project/logs/access.log;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    error_log </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">/root/project/logs/error.log;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    ssl_certificate </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">    /root/project/conf/cert/214915882850706.pem;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    ssl_certificate_key </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">/root/project/conf/cert/214915882850706.key;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    ssl_session_timeout </span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">5m</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    ssl_ciphers </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    ssl_protocols </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">TLSv1 TLSv1.1 TLSv1.2;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    ssl_prefer_server_ciphers </span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;">on</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">        include </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">uwsgi_params;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">        uwsgi_pass </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">172.18.61.250:8000;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    location</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> /static/ {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">        alias </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">/root/project/static/;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">        expires </span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">30d</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>到此为止，我们可以启动Nginx来访问我们的应用程序，HTTP和HTTPS都是没有问题的，如果Nginx已经运行，在修改配置文件后，我们可以用下面的命令重新启动Nginx。</p></li><li><p>重启Nginx服务器。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> reload</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>或</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> nginx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ol><blockquote><p>说明：可以对Django项目使用<code>python manage.py collectstatic</code>命令将静态资源收集到指定目录下，要做到这点只需要在项目的配置文件<code>settings.py</code>中添加<code>STATIC_ROOT</code>配置即可。</p></blockquote><h4 id="负载均衡配置" tabindex="-1">负载均衡配置 <a class="header-anchor" href="#负载均衡配置" aria-label="Permalink to &quot;负载均衡配置&quot;">​</a></h4><p>下面的配置中我们使用Nginx实现负载均衡，为另外的三个Nginx服务器（通过Docker创建）提供反向代理服务。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> 801:80</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> --name</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> nginx1</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> nginx:latest</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> 802:80</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> --name</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> nginx2</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> nginx:latest</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> 803:80</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> --name</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> nginx3</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> nginx:latest</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-Nginx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Nginx</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">user </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">root;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">worker_processes </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">auto;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">error_log </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">/var/log/nginx/error.log;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">pid </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">/run/nginx.pid;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">include </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">/usr/share/nginx/modules/*.conf;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">events</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    worker_connections </span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 为HTTP服务配置负载均衡</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">http</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">	upstream</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> xx {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">		server</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 192.168.1.100</span><span style="--shiki-light:#B392F0;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> weight</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">		server </span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">192.168.1.101</span><span style="--shiki-light:#B392F0;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> weight</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">		server </span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">192.168.1.102</span><span style="--shiki-light:#B392F0;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> weight</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">	server {</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">		listen       </span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">80</span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;"> default_server</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">		listen </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">      [::]:80 </span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;">default_server</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">		listen </span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">      443</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> ssl;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">		listen </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">      [::]:443 ssl;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">        ssl </span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;">on</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">		access_log </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">/root/project/logs/access.log;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">		error_log </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">/root/project/logs/error.log;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">		ssl_certificate </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">/root/project/conf/cert/214915882850706.pem;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">		ssl_certificate_key </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">/root/project/conf/cert/214915882850706.key;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">		ssl_session_timeout </span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">5m</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">		ssl_ciphers </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">		ssl_protocols </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">TLSv1 TLSv1.1 TLSv1.2;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">		ssl_prefer_server_ciphers </span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;">on</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">		location</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">			proxy_set_header </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">Host $</span><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">host</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">			proxy_set_header </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">X-Forwarded-For $</span><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">remote_addr</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">			# proxy_set_header X-Real-IP $remote_addr;</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">			# proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">			proxy_buffering </span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;">off</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">			proxy_pass </span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">http://fangtx;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">		}</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><blockquote><p>说明：Nginx在配置负载均衡时，默认使用WRR（加权轮询算法），除此之外还支持ip_hash、fair（需要安装upstream_fair模块）和url_hash算法。此外，在配置upstream模块时可以指定服务器的状态值，包括：backup（备份机器，其他服务器不可用时才将请求分配到该机器）、down、fail_timeout（请求失败达到max_fails后的暂停服务时间）、max_fails（允许请求失败的次数）和weight（轮询的权重）。</p></blockquote><h3 id="keepalived" tabindex="-1">Keepalived <a class="header-anchor" href="#keepalived" aria-label="Permalink to &quot;Keepalived&quot;">​</a></h3><p>当使用Nginx进行负载均衡配置时，要考虑负载均衡服务器宕机的情况。为此可以使用Keepalived来实现负载均衡主机和备机的热切换，从而保证系统的高可用性。Keepalived的配置还是比较复杂，通常由专门做运维的人进行配置，一个基本的配置可以参照<a href="https://www.jianshu.com/p/dd93bc6d45f5" target="_blank" rel="noreferrer">《Keepalived的配置和使用》</a>。</p><h3 id="mysql主从复制" tabindex="-1">MySQL主从复制 <a class="header-anchor" href="#mysql主从复制" aria-label="Permalink to &quot;MySQL主从复制&quot;">​</a></h3><p>下面还是基于Docker来演示如何配置MySQL主从复制。我们事先准备好MySQL的配置文件以及保存MySQL数据和运行日志的目录，然后通过Docker的数据卷映射来指定容器的配置、数据和日志文件的位置。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">root</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">└──</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> mysql</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">    ├──</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> master</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">    │  </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> ├──</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> conf</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">    |</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">	└──</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> data</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">    └──</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> slave-1</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">    |</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">	├──</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> conf</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">    |</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">	└──</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> data</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">    └──</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> slave-2</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">    |</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">	├──</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> conf</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">    |</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">	└──</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> data</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">    └──</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> slave-3</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">    	├──</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> conf</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">    	└──</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> data</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol><li><p>MySQL的配置文件（master和slave的配置文件需要不同的server-id）。</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span>[mysqld]</span></span>
<span class="line"><span>pid-file=/var/run/mysqld/mysqld.pid</span></span>
<span class="line"><span>socket=/var/run/mysqld/mysqld.sock</span></span>
<span class="line"><span>datadir=/var/lib/mysql</span></span>
<span class="line"><span>log-error=/var/log/mysql/error.log</span></span>
<span class="line"><span>server-id=1</span></span>
<span class="line"><span>log-bin=/var/log/mysql/mysql-bin.log</span></span>
<span class="line"><span>expire_logs_days=30</span></span>
<span class="line"><span>max_binlog_size=256M</span></span>
<span class="line"><span>symbolic-links=0</span></span>
<span class="line"><span># slow_query_log=ON</span></span>
<span class="line"><span># slow_query_log_file=/var/log/mysql/slow.log</span></span>
<span class="line"><span># long_query_time=1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li><li><p>创建和配置master。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> 3306:3306</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> --name</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> mysql-master</span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">-v </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">/root/mysql/master/conf:/etc/mysql/mysql.conf.d</span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">-v </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">/root/mysql/master/data:/var/lib/mysql</span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">-e </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">MYSQL_ROOT_PASSWORD=</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">123456</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> mysql:5.7</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -it</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> mysql-master</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> /bin/bash</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">mysql</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -u</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -p</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">Enter</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> password:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">Welcome</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> MySQL</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> monitor.</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">  Commands</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> end</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> with</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> ; </span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">or</span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;"> \\g</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">.</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">Your</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> MySQL</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> connection</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> id</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> is</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">Server</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> version:</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> 5.7.23-log</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> MySQL</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> Community</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> Server</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> (GPL)</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">Copyright</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">Oracle</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> is</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> a</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> registered</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> trademark</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> of</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> Oracle</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> Corporation</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> and/or</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> its</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">affiliates.</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> Other</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> names</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> may</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> be</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> trademarks</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> of</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> their</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> respective</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">owners.</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">Type</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &#39;help;&#39;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> or</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &#39;\\h&#39;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> help.</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> Type</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &#39;\\c&#39;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> clear</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> current</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> input</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> statement.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">mysql</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">grant</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> replication</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> slave</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> on</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">.</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &#39;slave&#39;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">@</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> identified</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> by</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &#39;iamslave&#39;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">Query</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> OK,</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> rows</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> affected,</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> warning</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> (0.00 </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">sec</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">mysql</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">flush</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> privileges</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">Query</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> OK,</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> rows</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> affected</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> (0.00 </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">sec</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">mysql</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">show</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> master</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> status</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">+------------------+----------+--------------+------------------+-------------------+</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> File</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">             |</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> Position</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> Binlog_Do_DB</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> Binlog_Ignore_DB</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> Executed_Gtid_Set</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;"> |</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">+------------------+----------+--------------+------------------+-------------------+</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> mysql-bin.000003</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">      590</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">              |</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">                  |</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">                   |</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">+------------------+----------+--------------+------------------+-------------------+</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">1</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> row</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> set</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> (0.00 </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">sec</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">mysql</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">quit</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">Bye</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;">exit</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>上面创建Docker容器时使用的<code>-v</code>参数（<code>--volume</code>）表示映射数据卷，冒号前是宿主机的目录，冒号后是容器中的目录，这样相当于将宿主机中的目录挂载到了容器中。</p></li><li><p>备份主表中的数据（如果需要的话）。</p><div class="language-SQL vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">mysql</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> flush </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">table</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> with</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> read</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> lock;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-Bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Bash</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">mysqldump</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -u</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 123456</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -B</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> /root/backup/mysql/mybak</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">$(</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">date</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> +</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&quot;%Y%m%d%H%M%S&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">.sql</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-SQL vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">mysql</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> unlock</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> table</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>创建和配置slave。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> 3308:3306</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> --name</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> mysql-slave-1</span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">-v </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">/root/mysql/slave-1/conf:/etc/mysql/mysql.conf.d</span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">-v </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">/root/mysql/slave-1/data:/var/lib/mysql</span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">-e </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">MYSQL_ROOT_PASSWORD=</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">123456</span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">--link </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">mysql-master:mysql-master</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> mysql:5.7</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> 3309:3306</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> --name</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> mysql-slave-2</span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">-v </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">/root/mysql/slave-2/conf:/etc/mysql/mysql.conf.d</span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">-v </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">/root/mysql/slave-2/data:/var/lib/mysql</span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">-e </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">MYSQL_ROOT_PASSWORD=</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">123456</span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">--link </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">mysql-master:mysql-master</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> mysql:5.7</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> 3310:3306</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> --name</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> mysql-slave-3</span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">-v </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">/root/mysql/slave-3/conf:/etc/mysql/mysql.conf.d</span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">-v </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">/root/mysql/slave-3/data:/var/lib/mysql</span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">-e </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">MYSQL_ROOT_PASSWORD=</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">123456</span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">--link </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">mysql-master:mysql-master</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> mysql:5.7</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -it</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> mysql-slave-1</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> /bin/bash</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">mysql</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -u</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -p</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">Enter</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> password:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">Welcome</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> MySQL</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> monitor.</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">  Commands</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> end</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> with</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> ; </span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">or</span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;"> \\g</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">.</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">Your</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> MySQL</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> connection</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> id</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> is</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">Server</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> version:</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> 5.7.23-log</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> MySQL</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> Community</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> Server</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> (GPL)</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">Copyright</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">Oracle</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> is</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> a</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> registered</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> trademark</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> of</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> Oracle</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> Corporation</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> and/or</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> its</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">affiliates.</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> Other</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> names</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> may</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> be</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> trademarks</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> of</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> their</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> respective</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">owners.</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">Type</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &#39;help;&#39;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> or</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &#39;\\h&#39;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> help.</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> Type</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &#39;\\c&#39;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> clear</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> current</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> input</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> statement.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">mysql</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">reset</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> slave</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">Query</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> OK,</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> rows</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> affected</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> (0.02 </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">sec</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">mysql</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">change</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> master</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> master_host=</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&#39;mysql-master&#39;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> master_user=</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&#39;slave&#39;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> master_password=</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&#39;iamslave&#39;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> master_log_file=</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&#39;mysql-bin.000003&#39;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> master_log_pos=</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">590</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">Query</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> OK,</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> rows</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> affected,</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> warnings</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> (0.03 </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">sec</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">mysql</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">start</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> slave</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">Query</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> OK,</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> rows</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> affected</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> (0.01 </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">sec</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">mysql</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">show</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> slave</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> status</span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;">\\G</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">***************************</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> 1. row </span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">***************************</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">               Slave_IO_State:</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> Waiting</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> master</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> send</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> event</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">                  Master_Host:</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> mysql57</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">                  Master_User:</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> slave</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">                  Master_Port:</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 3306</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">                Connect_Retry:</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 60</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">              Master_Log_File:</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> mysql-bin.000001</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">          Read_Master_Log_Pos:</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 590</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">               Relay_Log_File:</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> f352f05eb9d0-relay-bin.000002</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">                Relay_Log_Pos:</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 320</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">        Relay_Master_Log_File:</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> mysql-bin.000001</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">             Slave_IO_Running:</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> Yes</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">            Slave_SQL_Running:</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> Yes</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">             Replicate_Do_DB:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">          Replicate_Ignore_DB:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">           Replicate_Do_Table:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">       Replicate_Ignore_Table:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">      Replicate_Wild_Do_Table:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">  Replicate_Wild_Ignore_Table:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">                   Last_Errno:</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">                   Last_Error:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">                 Skip_Counter:</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">          Exec_Master_Log_Pos:</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 590</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">              Relay_Log_Space:</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 534</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">              Until_Condition:</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> None</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">               Until_Log_File:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">                Until_Log_Pos:</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">           Master_SSL_Allowed:</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> No</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">           Master_SSL_CA_File:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">           Master_SSL_CA_Path:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">              Master_SSL_Cert:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">            Master_SSL_Cipher:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">               Master_SSL_Key:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">        Seconds_Behind_Master:</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">Master_SSL_Verify_Server_Cert:</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> No</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">                Last_IO_Errno:</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">                Last_IO_Error:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">               Last_SQL_Errno:</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">               Last_SQL_Error:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">  Replicate_Ignore_Server_Ids:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">             Master_Server_Id:</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">                  Master_UUID:</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> 30c38043-ada1-11e8-8fa1-0242ac110002</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">             Master_Info_File:</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> /var/lib/mysql/master.info</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">                    SQL_Delay:</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">          SQL_Remaining_Delay:</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> NULL</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">      Slave_SQL_Running_State:</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> Slave</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> has</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> read</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> all</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> relay</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> log</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">waiting</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> more</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> updates</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">           Master_Retry_Count:</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 86400</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">                  Master_Bind:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">      Last_IO_Error_Timestamp:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">     Last_SQL_Error_Timestamp:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">               Master_SSL_Crl:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">           Master_SSL_Crlpath:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">           Retrieved_Gtid_Set:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">            Executed_Gtid_Set:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">                Auto_Position:</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">         Replicate_Rewrite_DB:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">                 Channel_Name:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">           Master_TLS_Version:</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">1</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> row</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> set</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> (0.00 </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">sec</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">mysql</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">quit</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">Bye</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;">exit</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br></div></div><p>接下来可以如法炮制配置出slave2和slave3，这样就可以搭建起一个“一主带三从”的主从复制环境。上面创建创建容器时使用的<code>--link</code>参数用来配置容器在网络上的主机名（网络地址别名）。</p></li></ol><p>配置好主从复制后，写数据的操作应该master上执行，而读数据的操作应该在slave上完成。为此，在Django项目中需要配置DATABASE_ROUTERS并通过自定义的主从复制路由类来实现读写分离操作，如下所示：</p><div class="language-Python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">DATABASE_ROUTERS</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> [</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 此处省略其他配置</span></span>
<span class="line"><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">    &#39;common.routers.MasterSlaveRouter&#39;</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-Python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#B392F0;--shiki-dark:#E5C07B;"> MasterSlaveRouter</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#56B6C2;">object</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-dark:#98C379;">    &quot;&quot;&quot;主从复制路由&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">    @</span><span style="--shiki-light:#79B8FF;--shiki-dark:#56B6C2;">staticmethod</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> db_for_read</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">model</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;"> **</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">hints</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-dark:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-dark:#98C379;">        Attempts to read auth models go to auth_db.</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-dark:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> random</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">choice</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&#39;slave1&#39;</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&#39;slave2&#39;</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&#39;slave3&#39;</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">    @</span><span style="--shiki-light:#79B8FF;--shiki-dark:#56B6C2;">staticmethod</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> db_for_write</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">model</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;"> **</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">hints</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-dark:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-dark:#98C379;">        Attempts to write auth models go to auth_db.</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-dark:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &#39;default&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">    @</span><span style="--shiki-light:#79B8FF;--shiki-dark:#56B6C2;">staticmethod</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> allow_relation</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">obj1</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> obj2</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;"> **</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">hints</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-dark:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-dark:#98C379;">        Allow relations if a model in the auth app is involved.</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-dark:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;"> None</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">    @</span><span style="--shiki-light:#79B8FF;--shiki-dark:#56B6C2;">staticmethod</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    def</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> allow_migrate</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">db</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> app_label</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> model_name</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;">None</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;"> **</span><span style="--shiki-light:#FF9800;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">hints</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-dark:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-dark:#98C379;">        Make sure the auth app only appears in the &#39;auth_db&#39;</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-dark:#98C379;">        database.</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-dark:#98C379;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#79B8FF;--shiki-dark:#D19A66;"> True</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>上面的内容参考了Django官方文档的<a href="https://docs.djangoproject.com/en/2.1/topics/db/multi-db/#topics-db-multi-db-routing" target="_blank" rel="noreferrer">DATABASE_ROUTERS配置</a>，对代码进行了适当的调整。</p><h3 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-label="Permalink to &quot;Docker&quot;">​</a></h3><p>事实上，项目上线中最为麻烦的事情就是配置软件运行环境，环境的差异会给软件的安装和部署带来诸多的麻烦，而Docker正好可以解决这个问题。关于Docker在之前的文档中我们已经介绍过了，接下来我们对Docker的知识做一些必要的补充。</p><ol><li><p>创建镜像文件。</p><p>将容器保存成镜像：</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> commit</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -m</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &quot;...&quot;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &quot;jackfrued&quot;</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">container-nam</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> jackfrued/</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">image-nam</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>使用Dockerfile构建镜像：</p><div class="language-Dockerfile vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Dockerfile</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 指定基础镜像文件</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> centos:latest</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 指定维护者信息</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#61AFEF;">MAINTAINER</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> jackfrued</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 执行命令</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> yum -y install gcc</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> cd ~</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> mkdir -p project/code</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> mkdir -p project/logs</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 拷贝文件</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#61AFEF;">COPY</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 暴露端口</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#61AFEF;">EXPOSE</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 在容器启动时执行命令</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#61AFEF;">CMD</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> ~/init.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> build</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -t</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> jackfrued/</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">image-nam</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> .</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>镜像的导入和导出。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> save</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">file-nam</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">.tar</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">image-nam</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">versio</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">n</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> load</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">file-nam</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">.tar</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>推送到DockerHub服务器。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> tag</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">image-nam</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">versio</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">n</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> jackfrued/</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">nam</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> login</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> push</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> jackfrued/</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">nam</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p>容器之间的通信。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> --link</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">container-nam</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;">alias-nam</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ol><p>如果我们能够在Docker中完成项目的部署，并且将整个部署好的容器打包成镜像文件进行分发和安装，这样就可以解决项目在多个节点上进行部署时可能遇到的麻烦，而且整个部署可以在很短的时间内完成。</p><h3 id="supervisor" tabindex="-1">Supervisor <a class="header-anchor" href="#supervisor" aria-label="Permalink to &quot;Supervisor&quot;">​</a></h3><p><a href="https://github.com/Supervisor/supervisor" target="_blank" rel="noreferrer">Supervisor</a>是一个用Python写的进程管理工具，可以很方便的用来在类Unix系统下启动、重启（自动重启程序）和关闭进程，目前Supervisor暂时还没有提供对Python 3的支持，可以通过Python 2来安装和运行Supervisor，再通过Supervisor来管理Python 3的程序。</p><blockquote><p><strong>提示</strong>：还有一个和Supervisor功能类似的工具名为Circus，支持Python 3。</p></blockquote><ol><li><p>安装Supervisor。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">virtualenv</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> /usr/bin/python</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> venv</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;">source</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> venv/bin/activate</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">pip</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> supervisor</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p>查看Supervisor的配置文件。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">vim</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> /etc/supervisord.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-INI vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">INI</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">; 此处省略上面的代码</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">; The [include] section can just contain the &quot;files&quot; setting.  This</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">; setting can list multiple files (separated by whitespace or</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">; newlines).  It can also contain wildcards.  The filenames are</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">; interpreted as relative to this file.  Included files *cannot*</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">; include files themselves.</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">[include]</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">files</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;"> supervisord.d/*.ini</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>可以看出自定义的管理配置代码可以放在<code>/etc/supervisord.d</code>目录中，并且文件名以<code>ini</code>作为后缀即可。</p></li><li><p>编写自己的配置文件<code>fangtx.ini</code>并放在<code>/etc/supervisord.d</code>目录中。</p><div class="language-INI vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">INI</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">[program:project]</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">command</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">uwsgi --ini /root/project/conf/uwsgi.ini</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">stopsignal</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">QUIT</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">autostart</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">true</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">autorestart</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">true</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">redirect_stderr</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">[program:celery]</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">; Set full path to celery program if using virtualenv</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">command</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">/root/project/venv/bin/celery -A fangtx worker</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">user</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">numprocs</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">1</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">stdout_logfile</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">/var/log/supervisor/celery.log</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">stderr_logfile</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">/var/log/supervisor/celery_error.log</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">autostart</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">true</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">autorestart</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">true</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">startsecs</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">10</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">; Need to wait for currently executing tasks to finish at shutdown.</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">; Increase this if you have very long running tasks.</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">;stopwaitsecs = 600</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">; When resorting to send SIGKILL to the program to terminate it</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">; send SIGKILL to its whole process group instead,</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">; taking care of its children as well.</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">killasgroup</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">true</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">; Set Celery priority higher than default (999)</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">; so, if rabbitmq is supervised, it will start first.</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">priority</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#98C379;">1000</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div></li><li><p>启动Supervisor。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">supervisorctl</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> /etc/supervisord.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ol><h3 id="其他服务" tabindex="-1">其他服务 <a class="header-anchor" href="#其他服务" aria-label="Permalink to &quot;其他服务&quot;">​</a></h3><ol><li><p>常用开源软件。</p><table tabindex="0"><thead><tr><th>功能</th><th>开源方案</th></tr></thead><tbody><tr><td>版本控制工具</td><td>Git、Mercurial、SVN</td></tr><tr><td>缺陷管理</td><td>Redmine、Mantis</td></tr><tr><td>负载均衡</td><td>Nginx、LVS、HAProxy</td></tr><tr><td>邮件服务</td><td>Postfix、Sendmail</td></tr><tr><td>HTTP服务</td><td>Nginx、Apache</td></tr><tr><td>消息队列</td><td>RabbitMQ、ZeroMQ、Redis、Kafka</td></tr><tr><td>文件系统</td><td>FastDFS</td></tr><tr><td>基于位置服务（LBS）</td><td>MongoDB、Redis</td></tr><tr><td>监控服务</td><td>Nagios、Zabbix</td></tr><tr><td>关系型数据库</td><td>MySQL、PostgreSQL</td></tr><tr><td>非关系型数据库</td><td>MongoDB、Redis、Cassandra、TiDB</td></tr><tr><td>搜索引擎</td><td>ElasticSearch、Solr</td></tr><tr><td>缓存服务</td><td>Mamcached、Redis</td></tr></tbody></table></li><li><p>常用云服务。</p><table tabindex="0"><thead><tr><th>功能</th><th>可用的云服务</th></tr></thead><tbody><tr><td>团队协作工具</td><td>Teambition、钉钉</td></tr><tr><td>代码托管平台</td><td>Github、Gitee、CODING</td></tr><tr><td>邮件服务</td><td>SendCloud</td></tr><tr><td>云存储（CDN）</td><td>七牛、OSS、LeanCloud、Bmob、又拍云、S3</td></tr><tr><td>移动端推送</td><td>极光、友盟、百度</td></tr><tr><td>即时通信</td><td>环信、融云</td></tr><tr><td>短信服务</td><td>云片、极光、Luosimao、又拍云</td></tr><tr><td>第三方登录</td><td>友盟、ShareSDK</td></tr><tr><td>网站监控和统计</td><td>阿里云监控、监控宝、百度云观测、小鸟云</td></tr></tbody></table></li></ol>`,47)]))}const C=i(r,[["render",d]]);export{b as __pageData,C as default};
