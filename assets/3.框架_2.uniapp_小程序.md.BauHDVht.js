import{_ as i,c as a,a2 as n,o as e}from"./chunks/framework.BeuUUHFt.js";const o=JSON.parse('{"title":"小程序开发","description":"","frontmatter":{},"headers":[],"relativePath":"3.框架/2.uniapp/小程序.md","filePath":"3.框架/2.uniapp/小程序.md","lastUpdated":1731997977000}'),l={name:"3.框架/2.uniapp/小程序.md"};function t(p,s,h,k,r,B){return e(),a("div",null,s[0]||(s[0]=[n(`<h1 id="小程序开发" tabindex="-1">小程序开发 <a class="header-anchor" href="#小程序开发" aria-label="Permalink to &quot;小程序开发&quot;">​</a></h1><blockquote><p>专业名词：</p><p>openid: 用户唯一标识</p><p>session_key: 会话密钥</p><p>unionid: 同一个微信开放平台下的用户唯一标识</p></blockquote><h2 id="openid" tabindex="-1">openid <a class="header-anchor" href="#openid" aria-label="Permalink to &quot;openid&quot;">​</a></h2><p><code>微信用户唯一认证</code>，为了识别用户，每个用户针对每个公众号或小程序等应用会产生一个安全的openid</p><h3 id="微信小程序获取openid" tabindex="-1">微信小程序获取openid <a class="header-anchor" href="#微信小程序获取openid" aria-label="Permalink to &quot;微信小程序获取openid&quot;">​</a></h3><h4 id="第一步、获取临时登录凭证" tabindex="-1">第一步、获取临时登录凭证 <a class="header-anchor" href="#第一步、获取临时登录凭证" aria-label="Permalink to &quot;第一步、获取临时登录凭证&quot;">​</a></h4><p>login方法获取<code>临时登录凭证code </code>，再传入该code到服务器</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#FFAB70;--shiki-dark:#E06C75;">template</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#FFAB70;--shiki-dark:#E06C75;">view</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">&gt;&lt;</span><span style="--shiki-light:#FFAB70;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#B392F0;--shiki-dark:#FFFFFF;"> @click=&quot;weixinLogin&quot;&gt;小程序登录&lt;/button&gt;&lt;/view&gt;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#FFFFFF;">&lt;/template&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#FFFFFF;">&lt;script&gt;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">const</span><span style="--shiki-light:#B392F0;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> uniCloudObj</span><span style="--shiki-light:#B392F0;--shiki-dark:#FFFFFF;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#FFFFFF;"> uniCloud.importObject(&quot;weixinLogin&quot;)</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;">export</span><span style="--shiki-light:#B392F0;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> default</span><span style="--shiki-light:#B392F0;--shiki-dark:#C678DD;"> {</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">  methods</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">    weixinLogin</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">      uni</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">login</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">        provider</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &quot;weixin&quot;</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">        success</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#B392F0;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> res</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">          console</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">          const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;"> cloudRes</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;"> uniCloudObj</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">weixinLogin</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;"> res</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> })</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">          console</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">cloudRes</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">        }</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">        fail</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> {}</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">        complete</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> {}</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">      })</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#C678DD;">}</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#FFFFFF;">&lt;/script&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="第二步、服务器端请求jscode2session" tabindex="-1">第二步、服务器端请求<code>jscode2session</code> <a class="header-anchor" href="#第二步、服务器端请求jscode2session" aria-label="Permalink to &quot;第二步、服务器端请求\`jscode2session\`&quot;">​</a></h4><p>创建一个云对象，请求微信小程序<code>jscode2session</code>接口，通过传入<code>四个参数</code>到开发者服务器来获取<code>openid</code></p><ul><li>appid 小程序appId</li><li>secret 小程序appSecret</li><li>js_code 登录时获取的<code>临时登录凭证code</code></li><li>grant_type 授权类型，固定值，只需填写<code>authorization_code</code></li></ul><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">module</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">exports</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  /**</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   * 微信登录</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   * </span><span style="--shiki-light:#F97583;--shiki-light-font-style:inherit;--shiki-dark:#C678DD;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#B392F0;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;"> {*}</span><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> event</span><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> 前端传参</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   * </span><span style="--shiki-light:#F97583;--shiki-light-font-style:inherit;--shiki-dark:#C678DD;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#B392F0;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;"> {*}</span><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> context</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   * </span><span style="--shiki-light:#F97583;--shiki-light-font-style:inherit;--shiki-dark:#C678DD;--shiki-dark-font-style:italic;">@returns</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   */</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">  async</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> weixinLogin</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#B392F0;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">event</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#B392F0;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> context</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // event为前端传参</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&quot;event : &quot;</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;"> event</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 从中取出临时登录凭证code</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">      code</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;"> event</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;"> appId</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &quot;wx2c926655396494ed&quot;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;"> appSecret</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &quot;8c5480d4f1eed7113e3bbad21b2d0142&quot;</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // 拼接参数请求微信官方接口，进行登录凭证校验</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;"> res</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;"> uniCloud</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">httpclient</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">request</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">      &quot;https://api.weixin.qq.com/sns/jscode2session?appid=&quot;</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> +</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">      appId</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> +</span></span>
<span class="line"><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">      &quot;&amp;secret=&quot;</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> +</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">      appSecret</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> +</span></span>
<span class="line"><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">      &quot;&amp;js_code=&quot;</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> +</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">      code</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> +</span></span>
<span class="line"><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">      &quot;&amp;grant_type=authorization_code&quot;</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">        dataType</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &quot;json&quot;</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">      }</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">    )</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&quot;返回结果&quot;</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;"> res</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;"> res</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">data</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">  }</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>小程序appId和小程序appSecret在<a href="https://mp.weixin.qq.com/" target="_blank" rel="noreferrer">微信公众平台</a>&gt;开发&gt;开发管理中查看获取</p><h4 id="请求成功" tabindex="-1">请求成功 <a class="header-anchor" href="#请求成功" aria-label="Permalink to &quot;请求成功&quot;">​</a></h4><p>会得到<code>openid</code>和<code>session_key</code>返回值</p><p>想得到<code>unionid</code>则需要在<a href="https://open.weixin.qq.com/" target="_blank" rel="noreferrer">微信开放平台</a>进行了同一个开发主体的绑定作用</p><h2 id="session-key" tabindex="-1">session_key <a class="header-anchor" href="#session-key" aria-label="Permalink to &quot;session_key&quot;">​</a></h2><p><a href="https://blog.csdn.net/hbiao68/article/details/102827415" target="_blank" rel="noreferrer">https://blog.csdn.net/hbiao68/article/details/102827415</a></p><p><a href="https://developers.weixin.qq.com/community/develop/doc/00088a409fc308b765475fa4351000" target="_blank" rel="noreferrer">https://developers.weixin.qq.com/community/develop/doc/00088a409fc308b765475fa4351000</a></p><h2 id="unionid" tabindex="-1">unionid <a class="header-anchor" href="#unionid" aria-label="Permalink to &quot;unionid&quot;">​</a></h2><p>unionid也是用户的标识符，但它与openid不同的是，同一个微信用户，登录同一个开发主体下的多个小程序或公众号时，分配的unionid是一样的</p><p>也就是说，开发者拥有多个移动应用、网站应用、和公众帐号（包括小程序），可通过unionid来区分用户的唯一性</p><p>默认情况下，请求<code>jscode2session</code>会返回<code>openid</code>，但不会返回<code>unionid</code>，除非小程序等应用以及在<a href="https://open.weixin.qq.com/" target="_blank" rel="noreferrer">微信开放平台</a>进行了同一个开发主体的绑定</p><h2 id="获取用户信息" tabindex="-1">获取用户信息 <a class="header-anchor" href="#获取用户信息" aria-label="Permalink to &quot;获取用户信息&quot;">​</a></h2><p>注意点：</p><ol><li>该方法现在只能获取用户信息的昵称和头像，不能获取性别，国家和省市了</li><li>该方法只能作为单独的点击事件调用</li></ol><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">uni</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">getUserProfile</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">        desc</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &quot;测试&quot;</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">        success</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#B392F0;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> res</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">          console</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">res</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">      })</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="热更新失效" tabindex="-1">热更新失效 <a class="header-anchor" href="#热更新失效" aria-label="Permalink to &quot;热更新失效&quot;">​</a></h2><p>HBuilderX中运行uniapp项目至微信小程序开发者工具，修改HBuilderX中的代码，微信小程序开发者工具视图不热更新</p><p>1.设置&gt;通用设置&gt;编辑器&gt;取消勾选修改文件时自动保存</p><p>2.关闭热重载</p><h2 id="cannot-read-property-forceupdate-of-undefined" tabindex="-1">Cannot read property ‘forceUpdate‘ of undefined <a class="header-anchor" href="#cannot-read-property-forceupdate-of-undefined" aria-label="Permalink to &quot;Cannot read property ‘forceUpdate‘ of undefined&quot;">​</a></h2><p>微信小程序开发者工具控制台出现上方报错</p><p>需要在uniapp项目的manifest.json配置小程序的ID</p><h2 id="实现支付功能" tabindex="-1">实现支付功能 <a class="header-anchor" href="#实现支付功能" aria-label="Permalink to &quot;实现支付功能&quot;">​</a></h2><p>todo</p><h2 id="图片选择" tabindex="-1">图片选择 <a class="header-anchor" href="#图片选择" aria-label="Permalink to &quot;图片选择&quot;">​</a></h2><blockquote><p><a href="https://uniapp.dcloud.net.cn/api/media/video.html#choosemedia" target="_blank" rel="noreferrer">https://uniapp.dcloud.net.cn/api/media/video.html#choosemedia</a></p></blockquote><h3 id="uni-choosemedia" tabindex="-1">uni.chooseMedia <a class="header-anchor" href="#uni-choosemedia" aria-label="Permalink to &quot;uni.chooseMedia&quot;">​</a></h3><p>拍摄或从手机相册中选择图片或视频（新版微信小程序需要使用该api取代chooseImage）</p><h4 id="sourcetype" tabindex="-1">sourceType <a class="header-anchor" href="#sourcetype" aria-label="Permalink to &quot;sourceType&quot;">​</a></h4><p>默认是[&#39;album&#39;, &#39;camera&#39;]，会触发一个选择框，选择相册还是相机，只有一个参数则不会触发选择框，而是直接调用相册选择或者相机拍摄，所以可以自定义一个更好看的选择框，然后分别指定一个参数</p><table tabindex="0"><thead><tr><th style="text-align:left;">值</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">album</td><td style="text-align:left;">从相册选择</td></tr><tr><td style="text-align:left;">camera</td><td style="text-align:left;">使用相机拍摄</td></tr></tbody></table><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">   uni</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">chooseMedia</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">        count</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 9</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">        mediaType</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&quot;image&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">]</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">        sourceType</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&quot;album&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">]</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">        sizeType</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&quot;original&quot;</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &quot;compressed&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">]</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">        success</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#B392F0;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">          console</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">tempFiles</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">        }</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">      });</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">   uni</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">chooseMedia</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">        count</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 9</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">        mediaType</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&quot;image&quot;</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &quot;video&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">]</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">        sourceType</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&quot;camera&quot;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">]</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 拍摄视频最长拍摄时间，单位秒。时间范围为 3s 至 30s 之间</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">        maxDuration</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 30</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // 使用后置摄像头</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">        camera</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &quot;back&quot;</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">        success</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#B392F0;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">          console</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">tempFiles</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">        }</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">      });</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="sizetype是什么" tabindex="-1">sizeType是什么 <a class="header-anchor" href="#sizetype是什么" aria-label="Permalink to &quot;sizeType是什么&quot;">​</a></h3><blockquote><p><a href="https://developers.weixin.qq.com/community/develop/doc/0006c261a300089771f9a233a56c00" target="_blank" rel="noreferrer">https://developers.weixin.qq.com/community/develop/doc/0006c261a300089771f9a233a56c00</a></p><p><a href="https://ask.dcloud.net.cn/question/146679" target="_blank" rel="noreferrer">https://ask.dcloud.net.cn/question/146679</a></p></blockquote><p>第一个链接来自微信小程序社区，有开发者提了个问题：<code>sizeType: [&quot;original&quot;, &quot;compressed&quot;]</code>时，<code>tempFilePaths</code> 就应该是返回 2个路径才对，一个是原图的路径，一个是压缩图的路径，但实际上只返回了一个路径，那请问，这个返回的路径是原图的，还是压缩图的?</p><p>上方说法实际上是误解了<code>sizeType</code>配置，<code>sizeType: [&quot;original&quot;, &quot;compressed&quot;]</code>是控制用户相册选择图片时，可选择图片的类型（原图、压缩图），并不会同时上传，而是用户可以二选一，如果参数只有一个，则用户则不能选择图片类型</p><p>如果<code>sizeType: [&quot;original&quot;]</code>则用户上传图片只能是原图，相册选择时最下方会有一个<code>原图</code>的radio按钮，是置灰的，不可取消</p><p>如果<code>sizeType: [&quot;original&quot;, &quot;compressed&quot;]</code>，相册选择时最下方会有一个<code>原图</code>的radio按钮，可以取消勾选</p><p>如果<code>sizeType: [&quot;compressed&quot;]</code>，相册选择时最下方没有<code>原图</code>的radio按钮，只能上传压缩图</p><h3 id="同时获取原图和缩略图" tabindex="-1">同时获取原图和缩略图 <a class="header-anchor" href="#同时获取原图和缩略图" aria-label="Permalink to &quot;同时获取原图和缩略图&quot;">​</a></h3><p><code>uni.chooseImage</code> 是 uni-app 中对 <code>wx.chooseImage</code> 的包装，并没有做功能上的修改，微信小程序中设计如此 想要同时获取原图和缩略图，可尝试在<code>uni.chooseImage</code> 后用 <code>uni.compressImage</code> 压缩图片并获取压缩后的路径 新版本小程序使用<code>uni.chooseMedia</code>替换<code>uni.chooseImage</code>，但<code>sizeType</code>配置还是一样，所以同理</p><h2 id="兼容苹果手机底部黑线区域" tabindex="-1">兼容苹果手机底部黑线区域 <a class="header-anchor" href="#兼容苹果手机底部黑线区域" aria-label="Permalink to &quot;兼容苹果手机底部黑线区域&quot;">​</a></h2><div class="language-css vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#FFAB70;--shiki-dark:#E06C75;">padding-bottom</span><span style="--shiki-light:#B392F0;--shiki-dark:#C678DD;">: constant(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#E06C75;">safe-area-inset-bottom</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">);//</span><span style="--shiki-light:#B392F0;--shiki-dark:#C678DD;">兼容 IOS&lt;11</span><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">.2</span></span>
<span class="line"><span style="--shiki-light:#FFAB70;--shiki-dark:#E06C75;">padding-bottom</span><span style="--shiki-light:#B392F0;--shiki-dark:#C678DD;">: env(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#E06C75;">safe-area-inset-bottom</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">);//</span><span style="--shiki-light:#B392F0;--shiki-dark:#C678DD;">兼容 IOS</span><span style="--shiki-light:#F97583;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#B392F0;--shiki-dark:#C678DD;">11</span><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">.2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div>`,56)]))}const F=i(l,[["render",t]]);export{o as __pageData,F as default};
