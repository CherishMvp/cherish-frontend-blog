import{_ as i,c as a,a2 as n,o as t}from"./chunks/framework.BeuUUHFt.js";const o=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"Python-100-Days/Day36-40/40.大数据平台和HiveSQL.md","filePath":"Python-100-Days/Day36-40/40.大数据平台和HiveSQL.md","lastUpdated":1731997977000}'),e={name:"Python-100-Days/Day36-40/40.大数据平台和HiveSQL.md"};function l(p,s,h,k,d,r){return t(),a("div",null,s[0]||(s[0]=[n(`<h2 id="hive简介" tabindex="-1">Hive简介 <a class="header-anchor" href="#hive简介" aria-label="Permalink to &quot;Hive简介&quot;">​</a></h2><p>Hive是Facebook开源的一款基于Hadoop的数据仓库工具，是目前应用最广泛的大数据处理解决方案，它能将SQL查询转变为 MapReduce（Google提出的一个软件架构，用于大规模数据集的并行运算）任务，对SQL提供了完美的支持，能够非常方便的实现大数据统计。</p><img src="https://gitee.com/jackfrued/mypic/raw/master/20220210080608.png"><blockquote><p><strong>说明</strong>：可以通过<a href="https://www.edureka.co/blog/hadoop-ecosystem" target="_blank" rel="noreferrer">https://www.edureka.co/blog/hadoop-ecosystem</a>来了解Hadoop生态圈。</p></blockquote><p>如果要简单的介绍Hive，那么以下两点是其核心：</p><ol><li>把HDFS中结构化的数据映射成表。</li><li>通过把Hive-SQL进行解析和转换，最终生成一系列基于Hadoop的MapReduce任务/Spark任务，通过执行这些任务完成对数据的处理。也就是说，即便不学习Java、Scala这样的编程语言，一样可以实现对数据的处理。</li></ol><p>Hive和传统关系型数据库的对比如下表所示。</p><table tabindex="0"><thead><tr><th></th><th>Hive</th><th>RDBMS</th></tr></thead><tbody><tr><td>查询语言</td><td>HQL</td><td>SQL</td></tr><tr><td>存储数据</td><td>HDFS</td><td>本地文件系统</td></tr><tr><td>执行方式</td><td>MapReduce / Spark</td><td>Executor</td></tr><tr><td>执行延迟</td><td>高</td><td>低</td></tr><tr><td>数据规模</td><td>大</td><td>小</td></tr></tbody></table><h3 id="准备工作" tabindex="-1">准备工作 <a class="header-anchor" href="#准备工作" aria-label="Permalink to &quot;准备工作&quot;">​</a></h3><ol><li><p>搭建如下图所示的大数据平台。</p><p><img src="https://gitee.com/jackfrued/mypic/raw/master/20220210080638.png" alt="bigdata-basic-env"></p></li><li><p>通过Client节点访问大数据平台。</p><p><img src="https://gitee.com/jackfrued/mypic/raw/master/20220210080655.png" alt="bigdata-vpc"></p></li><li><p>创建文件Hadoop的文件系统。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">hadoop</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> fs</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -mkdir</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> /data</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">hadoop</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> fs</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -chmod</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> g+w</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> /data</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>将准备好的数据文件拷贝到Hadoop文件系统中。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">hadoop</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> fs</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -put</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> /home/ubuntu/data/</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> /data</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ol><h3 id="创建-删除数据库" tabindex="-1">创建/删除数据库 <a class="header-anchor" href="#创建-删除数据库" aria-label="Permalink to &quot;创建/删除数据库&quot;">​</a></h3><p>创建。</p><div class="language-SQL vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">create</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> database</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> if</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> not</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> exists</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> demo;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>或</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">hive</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &quot;create database demo;&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>删除。</p><div class="language-SQL vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">drop</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> database</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> exists</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> demo;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>切换。</p><div class="language-SQL vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">use</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> demo;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="数据类型" tabindex="-1">数据类型 <a class="header-anchor" href="#数据类型" aria-label="Permalink to &quot;数据类型&quot;">​</a></h3><p>Hive的数据类型如下所示。</p><p>基本数据类型。</p><table tabindex="0"><thead><tr><th>数据类型</th><th>占用空间</th><th>支持版本</th></tr></thead><tbody><tr><td>tinyint</td><td>1-Byte</td><td></td></tr><tr><td>smallint</td><td>2-Byte</td><td></td></tr><tr><td>int</td><td>4-Byte</td><td></td></tr><tr><td>bigint</td><td>8-Byte</td><td></td></tr><tr><td>boolean</td><td></td><td></td></tr><tr><td>float</td><td>4-Byte</td><td></td></tr><tr><td>double</td><td>8-Byte</td><td></td></tr><tr><td>string</td><td></td><td></td></tr><tr><td>binary</td><td></td><td>0.8版本</td></tr><tr><td>timestamp</td><td></td><td>0.8版本</td></tr><tr><td>decimal</td><td></td><td>0.11版本</td></tr><tr><td>char</td><td></td><td>0.13版本</td></tr><tr><td>varchar</td><td></td><td>0.12版本</td></tr><tr><td>date</td><td></td><td>0.12版本</td></tr></tbody></table><p>复杂数据类型。</p><table tabindex="0"><thead><tr><th>数据类型</th><th>描述</th><th>例子</th></tr></thead><tbody><tr><td>struct</td><td>和C语言中的结构体类似</td><td><code>struct&lt;first_name:string, last_name:string&gt;</code></td></tr><tr><td>map</td><td>由键值对构成的元素的集合</td><td><code>map&lt;string,int&gt;</code></td></tr><tr><td>array</td><td>具有相同类型的变量的容器</td><td><code>array&lt;string&gt;</code></td></tr></tbody></table><h3 id="创建和使用表" tabindex="-1">创建和使用表 <a class="header-anchor" href="#创建和使用表" aria-label="Permalink to &quot;创建和使用表&quot;">​</a></h3><ol><li><p>创建内部表。</p><div class="language-SQL vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">create</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> table</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> if</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> not</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> exists</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> user_info </span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">user_id string,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">user_name string, </span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">sex string,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">age </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">city string,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">firstactivetime string,</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">level</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">extra1 string,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">extra2 map</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">string,string</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">row</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">by</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &#39;\\t&#39;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">collection</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> items terminated </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">by</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &#39;,&#39;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">map keys terminated </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">by</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &#39;:&#39;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">lines terminated </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">by</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &#39;\\n&#39;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">stored </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> textfile;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li><li><p>加载数据。</p><div class="language-SQL vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">load</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> data</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> local</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> inpath </span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&#39;/home/ubuntu/data/user_info/user_info.txt&#39;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> overwrite </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">into</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> table</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> user_info;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>或</p><div class="language-SQL vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">load</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> data</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> inpath </span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&#39;/data/user_info/user_info.txt&#39;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> overwrite </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">into</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> table</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> user_info;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>创建分区表。</p><div class="language-SQL vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">create</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> table</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> if</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> not</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> exists</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> user_trade </span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">user_name string,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">piece </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">price double,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">pay_amount double,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">goods_category string,</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">pay_time </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">bigint</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">)  </span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">partitioned </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">by</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> (dt string)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">row</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> format delimited fields terminated </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">by</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &#39;\\t&#39;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li><li><p>设置动态分区。</p><div class="language-SQL vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">set</span><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;"> hive</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">exec</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">dynamic</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">partition</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">true;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">set</span><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;"> hive</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">exec</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">dynamic</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">partition</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.mode</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">nonstrict;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">set</span><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;"> hive</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">exec</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">max</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">dynamic</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.partitions</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">10000</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">set</span><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;"> hive</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">exec</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">max</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">dynamic</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">partitions</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#D19A66;">pernode</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">10000</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li><li><p>拷贝数据（Shell命令）。</p><div class="language-Shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">hdfs</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> dfs</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#D19A66;"> -put</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> /home/ubuntu/data/user_trade/</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#9DB1C5;--shiki-dark:#98C379;"> /user/hive/warehouse/demo.db/user_trade</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>修复分区表。</p><div class="language-SQL vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">msck repair </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">table</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> user_trade;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ol><h3 id="查询" tabindex="-1">查询 <a class="header-anchor" href="#查询" aria-label="Permalink to &quot;查询&quot;">​</a></h3><h4 id="基本语法" tabindex="-1">基本语法 <a class="header-anchor" href="#基本语法" aria-label="Permalink to &quot;基本语法&quot;">​</a></h4><div class="language-SQL vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> user_name </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> user_info </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">where</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> city</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&#39;beijing&#39;</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> and</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> sex</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&#39;female&#39;</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> limit</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> user_name, piece, pay_amount </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> user_trade </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">where</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> dt</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&#39;2019-03-24&#39;</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> and</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> goods_category</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&#39;food&#39;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="group-by" tabindex="-1">group by <a class="header-anchor" href="#group-by" aria-label="Permalink to &quot;group by&quot;">​</a></h4><div class="language-SQL vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询2019年1月到4月，每个品类有多少人购买，累计金额是多少</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> goods_category, </span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;">count</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">distinct</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> user_name) </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> user_num, </span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;">sum</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(pay_amount) </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> total </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> user_trade </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">where</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> dt </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">between</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &#39;2019-01-01&#39;</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> and</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &#39;2019-04-30&#39;</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> group by</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> goods_category;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-SQL vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询2019年4月支付金额超过5万元的用户</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> user_name, </span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;">sum</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(pay_amount) </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> total </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> user_trade </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">where</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> dt </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">between</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &#39;2019-04-01&#39;</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> and</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &#39;2019-04-30&#39;</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> group by</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> user_name </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">having</span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;"> sum</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(pay_amount) </span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 50000</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="order-by" tabindex="-1">order by <a class="header-anchor" href="#order-by" aria-label="Permalink to &quot;order by&quot;">​</a></h4><div class="language-SQL vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">SQL</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询2019年4月支付金额最多的用户前5名</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> user_name, </span><span style="--shiki-light:#B392F0;--shiki-dark:#56B6C2;">sum</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(pay_amount) </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> total </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> user_trade </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">where</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> dt </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">between</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &#39;2019-04-01&#39;</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> and</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &#39;2019-04-30&#39;</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> group by</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> user_name </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">order by</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> total </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">desc</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> limit</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="常用函数" tabindex="-1">常用函数 <a class="header-anchor" href="#常用函数" aria-label="Permalink to &quot;常用函数&quot;">​</a></h4><ol><li><code>from_unixtime</code>：将时间戳转换成日期</li><li><code>unix_timestamp</code>：将日期转换成时间戳</li><li><code>datediff</code>：计算两个日期的时间差</li><li><code>if</code>：根据条件返回不同的值</li><li><code>substr</code>：字符串取子串</li><li><code>get_json_object</code>：从JSON字符串中取出指定的<code>key</code>对应的<code>value</code>，如：<code>get_json_object(info, &#39;$.first_name&#39;)</code>。</li></ol>`,37)]))}const F=i(e,[["render",l]]);export{o as __pageData,F as default};
