import{_ as i,c as a,a2 as n,o as l}from"./chunks/framework.BeuUUHFt.js";const c=JSON.parse('{"title":"async和await","description":"","frontmatter":{},"headers":[],"relativePath":"2.JS/2.es6/async和await.md","filePath":"2.JS/2.es6/async和await.md","lastUpdated":1731997977000}'),e={name:"2.JS/2.es6/async和await.md"};function p(h,s,t,k,r,d){return l(),a("div",null,s[0]||(s[0]=[n(`<h1 id="async和await" tabindex="-1">async和await <a class="header-anchor" href="#async和await" aria-label="Permalink to &quot;async和await&quot;">​</a></h1><p><code>async</code> 是异步的意思，<code>await</code>则可以理解为 <code>async wait</code>。所以可以理解<code>async</code>就是用来声明一个异步方法，而 <code>await</code>是用来等待异步方法执行</p><h2 id="async" tabindex="-1">async <a class="header-anchor" href="#async" aria-label="Permalink to &quot;async&quot;">​</a></h2><p><code>async</code>函数返回一个<code>promise</code>对象，下面两种方法是等效的</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> f</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">resolve</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&#39;TEST&#39;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// asyncF is equivalent to f!</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> asyncF</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;"> &#39;TEST&#39;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>不管<code>await</code>后面跟着的是什么，<code>await</code>都会阻塞后面的代码</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> fn1</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> (){</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">    await</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> fn2</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 阻塞</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> fn2</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> (){</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#FFAB70;--shiki-dark:#98C379;">&#39;fn2&#39;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">fn1</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>上面的例子中，<code>await</code> 会阻塞下面的代码（即加入微任务队列），先执行 <code>async</code>外面的同步代码，同步代码执行完，再回到 <code>async</code> 函数中，再执行之前阻塞的代码</p><p>微任务的角度来看，异步函数中的 <code>await</code> 关键字会将 <code>await</code> 之后的代码封装为微任务，并将其加入微任务队列中，等待主线程执行完当前任务之后，再依次执行微任务队列中的任务。</p><p>因此，执行顺序如下：</p><ol><li>执行 <code>fn1()</code> 函数，输出 <code>1</code>，遇到 <code>await fn2()</code>，将 <code>console.log(&#39;fn2&#39;)</code> 封装为微任务。</li><li>执行 <code>fn2()</code> 函数，输出 <code>fn2</code>。</li><li>执行 <code>console.log(3)</code>，输出 <code>3</code>。</li><li>执行微任务 <code>fn1()</code> 中 <code>await</code> 之后的代码，输出 <code>2</code>。</li></ol><p>输出结果为：<code>1</code>，<code>fn2</code>，<code>3</code>，<code>2</code></p><h2 id="async返回值" tabindex="-1">async返回值 <a class="header-anchor" href="#async返回值" aria-label="Permalink to &quot;async返回值&quot;">​</a></h2><p><code>async</code> 函数的返回值是一个 Promise 对象。当函数内部有明确的 <code>return</code> 语句时，该返回值将成为 Promise 的 resolved 值；如果没有明确的 <code>return</code> 语句，该 Promise 的 resolved 值将会是 undefined。</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> asyncFunction</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">await</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> asyncFunction2</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 1</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> asyncFunction2</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> asyncFunction</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">await</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> asyncFunction2</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#6B737C;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// unde</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> asyncFunction2</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="async函数中返回异步函数的值" tabindex="-1">async函数中返回异步函数的值 <a class="header-anchor" href="#async函数中返回异步函数的值" aria-label="Permalink to &quot;async函数中返回异步函数的值&quot;">​</a></h3><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> asyncFunction1</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">  setTimeout</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">    a</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">  }</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 200</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在这个例子中，虽然我们在 setTimeout 中将 a 的值更改为 20，但是由于 setTimeout 是一个异步函数，它会在 200 毫秒后才会被调用。在此之前，asyncFunction1 已经在 200 毫秒之内返回了一个 Promise，Promise 的值是 a 的初始值 1，而不是更改后的值 2。</p><p>如果我们想要 asyncFunction1 的结果为更改后的值，可以将 setTimeout 包装成一个 Promise 并在其中返回一个新的值，然后在 asyncFunction1 中使用 await 等待 Promise 的完成，例如：</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes min-dark one-dark-pro vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> asyncFunction1</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">  await</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#79B8FF;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#B392F0;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">resolve</span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;"> setTimeout</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;">    a</span><span style="--shiki-light:#F97583;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#61AFEF;">    resolve</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">  }</span><span style="--shiki-light:#BBBBBB;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#F8F8F8;--shiki-dark:#D19A66;"> 200</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#F97583;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#B392F0;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#B392F0;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div>`,21)]))}const F=i(e,[["render",p]]);export{c as __pageData,F as default};
